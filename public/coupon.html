<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>優惠卷 - DeepSK</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .btn-back {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 15px;
            font-size: 16px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            z-index: 10;
            transition: background 0.3s;
        }

        .btn-back:hover {
            background: rgba(0, 0, 0, 0.8);
        }

        .coupon-container {
            max-width: 900px;
            margin: 60px auto 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 20px;
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .coupon-title-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .coupon-icon {
            width: 80px;
            height: 80px;
        }

        .coupon-title {
            font-size: 32px;
            color: #7a6229;
            font-weight: bold;
        }

        .coupon-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .coupon-table th {
            background: #8B7355;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            border: 2px solid #6B5344;
        }

        .coupon-table td {
            padding: 15px;
            text-align: center;
            border: 1px solid #D4AF8D;
            background: rgba(255, 255, 255, 0.8);
        }

        .coupon-table tr:nth-child(even) td {
            background: rgba(245, 235, 220, 0.6);
        }

        .coupon-table tr:hover td {
            background: rgba(220, 210, 195, 0.5);
        }
    </style>
</head>
<body class="bg-paper">

    <!-- 返回按鈕 -->
    <button class="btn-back" id="btnBack">← 返回</button>

    <!-- 優惠卷容器 -->
    <div class="coupon-container">
        <!-- 標題區域 -->
        <div class="coupon-title-section">
            <img src="Coupon icon.PNG" class="coupon-icon" alt="優惠卷圖示">
            <h1 class="coupon-title">你的優惠卷</h1>
        </div>

        <!-- 優惠卷表格 -->
        <table class="coupon-table">
            <thead>
                <tr>
                    <th>優惠卷序號</th>
                    <th>優惠卷名稱</th>
                    <th>獲得日期</th>
                    <th>使用期限</th>
                    <th>是否已使用</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>2</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>3</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>4</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td>5</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>

    <script src="main.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const from = params.get('from') === 'game' ? 'game' : 'home';
        const backTarget = from === 'game' ? 'game.html' : 'home.html';

        document.getElementById('btnBack').onclick = () => { window.location.href = backTarget; };
    </script>
    <script>
        (function renderCoupons() {
            const username = (typeof getCurrentUser === 'function') ? getCurrentUser() : null;
            const formatTime = (ts) => ts ? new Date(ts).toLocaleString('zh-TW') : '';

            let data = {};
            if (username) {
                const key = `coupons:${username}`;
                data = JSON.parse(localStorage.getItem(key) || '{}');
            }

            // 按照獲得時間排序，先取得的排在最上面
            const coupons = [];
            for (let id in data) {
                coupons.push({ id, ...data[id] });
            }
            coupons.sort((a, b) => a.obtainedAt - b.obtainedAt);

            const rows = document.querySelectorAll('.coupon-table tbody tr');
            
            rows.forEach((row, idx) => {
                const cells = row.querySelectorAll('td');
                const c = coupons[idx];

                cells[0].textContent = (idx + 1).toString();
                if (c) {
                    cells[1].textContent = c.name || '';
                    cells[2].textContent = formatTime(c.obtainedAt);
                    cells[3].textContent = formatTime(c.expiresAt);
                    cells[4].textContent = c.used ? '已使用' : '未使用';
                } else {
                    cells[1].textContent = '';
                    cells[2].textContent = '';
                    cells[3].textContent = '';
                    cells[4].textContent = '';
                }
            });

            if (!username) {
                const container = document.querySelector('.coupon-container');
                const msg = document.createElement('p');
                msg.textContent = '尚未登入，無法顯示優惠卷。';
                msg.style.marginTop = '16px';
                msg.style.color = '#7a6229';
                container.appendChild(msg);
            }
        })();
    </script>

</body>
</html>
